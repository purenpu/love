(()=>{let t={pages_visited:{}};const e="https://data-api.rippletek.com";t.config=require("./wxastat-config");t.remote_config=void wx.request({url:e+"/mmstat/miniapp/config.json",method:"GET",success:t=>{if(200===t.statusCode)for(let e in t.data)t.data.hasOwnProperty(e)&&wx.setStorageSync(e,t.data[e])}}),t.is_first_open=!1;const a=t=>new Promise((e,a)=>{t({success:t=>e(t),fail:t=>a(t)})}),o=t=>{try{return wx.getStorageSync(t)}catch(t){return""}},s=(t,e)=>{try{wx.setStorageSync(t,e)}catch(t){console.log(t)}},n=()=>{let e=o("wsastat_uuid");if(!e){t.is_first_open=!0;let a=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);e=`${a()+a()}-${a()}-${a()}-${a()}-${a()+a()+a()}`,s("wsastat_uuid",e)}return e},i=(t,e,a)=>{if(t[e]){let o=t[e];t[e]=function(t){a.call(this,t,e),o.call(this,t)}}else t[e]=function(t){a.call(this,t,e)}},p=(t,e,a)=>{if(t[e]){let o=t[e];t[e]=function(t){let s=o.call(this,t);return a.call(this,[t,s],e),s}}else t[e]=function(t){a.call(this,t,e)}},r=(a,o,s)=>{wx.request({url:e+"/mmstat/miniapp/upload",method:"POST",data:{wxastat_key:t.config.wxastat_key,app_id:t.config.app_id,uuid:t.uuid,msg_type:a,event:o,timestamp_launch:t.timestamp_launch,timestamp:Date.now(),is_first_open:t.is_first_open||!1,payload:s}})},l=(t,e)=>{r("event",t,e)};let u=function(){};u.prototype.sendEvent=function(t,e){r("custom_event",t,e)};const c=function(e){this.wxastat=new u,t.uuid=n(),t.timestamp_launch=Date.now(),l("appLaunch",{options:e}),(()=>{let t=[],e={};t.push(a(wx.getNetworkType),a(wx.getSystemInfo)),Promise.all(t).then(t=>{e.networkType=t[0].networkType,e.sdk_version=t[1].SDKVersion||"1.0.0",e.phone_model=t[1].model,e.pixel_ratio=t[1].pixelRatio,e.window_width=t[1].windowWidth,e.window_height=t[1].windowHeight,e.language=t[1].language,e.wechat_version=t[1].version,e.system=t[1].system,e.platform=t[1].platform,r("device","device",e)},t=>{console.log(t)})})()},_=e=>{l("AppUnLaunch",{options:e,duration:Date.now()-t.timestamp_launch})},h=e=>{let a=void 0;e&&e.query&&(a=e.query.wxastat_share_src),t.timestamp_app_show=Date.now(),l("appShow",{options:e,source:a})},g=()=>{l("appHide",{duration:Date.now()-t.timestamp_app_show,latest_page:t.latest_page,page_count:Object.keys(t.pages_visited).length})},d=t=>{l("appError",t)},w=(t,e)=>(e.current_page=t.__route__,e),f=function(t){l("pageLoad",w(this,{options:t}))},m=function(t){l("pageUnLoad",w(this,{options:t}))},x=function(e){let a=this.__route__.split("?")[0];t.pages_visited[a]=!0,t.last_page=t.latest_page,t.latest_page=a,t.timestamp_page_show=Date.now(),!0!==o("wxastat_userinfo_uploaded")&&wx.getSetting&&wx.getSetting({success:t=>{t.authSetting["scope.userInfo"]&&wx.getUserInfo({withCredentials:!1,success:t=>{r("user","user",t.userInfo),s("wxastat_userinfo_uploaded",!0)}})}}),l("pageShow",w(this,{options:e,last_page:t.last_page}))},y=function(e){t.timestamp_page_show?t.page_duration=Date.now()-t.timestamp_page_show:t.page_duration=0,l("pageHide",w(this,{options:e,duration:t.page_duration}))},S=function(t){l("pageReachBottom",w(this,{options:t}))},v=function(t){l("pagePullDownRefresh",w(this,{options:t}))},P=function(t){if(!t||!t[1])return;let e=t[0],a=t[1];if(l("shareClick",w(this,{options:e,share_info:a})),!a.path||"undefined"===a.path)return;-1!==a.path.indexOf("?")?a.path+="&wxastat_share_src="+n():a.path+="?wxastat_share_src="+n();let o=()=>{},s=a.success||o,i=a.fail||o;a.success=(t=>{l("shareSuccess",{options:e,share_info:a,result:t}),s(t)}),a.fail=(t=>{l("shareFail",{options:e,share_info:a,result:t}),i(t)})};App=(t=>e=>{i(e,"onLaunch",c),i(e,"onUnlaunch",_),i(e,"onShow",h),i(e,"onHide",g),i(e,"onError",d),t(e)})(App),Page=(t=>e=>{i(e,"onLoad",f),i(e,"onUnload",m),i(e,"onShow",x),i(e,"onHide",y),i(e,"onReachBottom",S),i(e,"onPullDownRefresh",v),e.onShareAppMessage&&p(e,"onShareAppMessage",P),t(e)})(Page),global&&global.App&&global.Page&&(global.App=App,global.Page=Page)})();